"use strict";var G=Object.create;var m=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var B=(e,n)=>{for(var s in n)m(e,s,{get:n[s],enumerable:!0})},V=(e,n,s,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of q(n))!N.call(e,a)&&a!==s&&m(e,a,{get:()=>n[a],enumerable:!(c=E(n,a))||c.enumerable});return e};var d=(e,n,s)=>(s=e!=null?G(A(e)):{},V(n||!e||!e.__esModule?m(s,"default",{value:e,enumerable:!0}):s,e)),k=e=>V(m({},"__esModule",{value:!0}),e);var J={};B(J,{createMessageHandler:()=>_});module.exports=k(J);var t=d(require("zod"),1);var r=d(require("zod"),1),P=r.object({showLegend:r.boolean().optional(),cooperativeGestures:r.boolean().optional(),fullScreenButton:r.boolean().optional(),geolocation:r.boolean().optional(),zoomControls:r.boolean().optional(),scaleBar:r.boolean().optional()}),b=r.object({type:r.literal("ui_controls.update"),params:P});var h={commands:[b],queries:null,listeners:null};var o=d(require("zod"),1);var p=d(require("zod"),1),z=p.number(),y=p.number(),S=p.object({latitude:y,longitude:z}),L=p.number().min(1).max(23),U=p.tuple([z,y,z,y]);var g=o.object({center:S,zoom:L}),te=o.intersection(g,o.object({bounds:U})),O=o.object({type:o.literal("viewport.get"),params:o.undefined()}),R=o.object({type:o.literal("center"),center:g.shape.center.optional(),zoom:g.shape.zoom.optional()}),C=o.object({type:o.literal("viewport.goto"),params:R}),j=o.object({eventName:o.literal("viewport.move"),id:o.string()});var Z={commands:[C],queries:[O],listeners:[j]};var u=[h,Z];var w={commands:u.map(e=>e.commands).flat(),queries:u.map(e=>e.queries??[]).flat(),listeners:u.map(e=>e.listeners??[]).flat()},D=t.discriminatedUnion("eventName",[t.object({eventName:t.literal("")}),...w.listeners]),H=t.object({type:t.literal("felt.addListener"),event:D}),I=t.object({type:t.literal("felt.removeListener"),id:t.string()}),T=t.strictObject({type:t.literal("felt.ready")}),v=t.discriminatedUnion("type",[T,H,I,...w.commands,...w.queries]),F=t.object({type:t.enum(v.options.map(e=>e.shape.type.value))});function _(e,n,s){let c=new Map;async function a(l){if(!F.safeParse(l.data).success){s?.onUnknownMessage?.(l.data);return}let x=v.safeParse(l.data);if(!x.success){s?.onInvalidMessage?.(l.data);return}let{data:i}=x;if(i.type==="felt.ready")l.ports[0]?.postMessage(!0);else if(i.type==="felt.addListener"){if(i.event.eventName==="")throw new Error("felt.addListener eventName cannot be empty");let f=n.listeners[i.event.eventName](M=>{l.ports[0]?.postMessage(M)});c.set(i.event.id,f)}else if(i.type==="felt.removeListener")c.get(i.id)?.(),c.delete(i.id);else{let f=n.methods[i.type],M=await f(i.params);l.ports[0]?.postMessage(M)}}return e.addEventListener("message",a),()=>{e.removeEventListener("message",a)}}0&&(module.exports={createMessageHandler});
