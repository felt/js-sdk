"use strict";var F=Object.create;var m=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var N=(e,n)=>{for(var r in n)m(e,r,{get:n[r],enumerable:!0})},V=(e,n,r,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of R(n))!A.call(e,a)&&a!==r&&m(e,a,{get:()=>n[a],enumerable:!(c=E(n,a))||c.enumerable});return e};var d=(e,n,r)=>(r=e!=null?F(q(e)):{},V(n||!e||!e.__esModule?m(r,"default",{value:e,enumerable:!0}):r,e)),B=e=>V(m({},"__esModule",{value:!0}),e);var K={};N(K,{createMessageHandler:()=>J});module.exports=B(K);var t=d(require("zod"),1);var s=d(require("zod"),1),k=s.object({showLegend:s.boolean().optional(),cooperativeGestures:s.boolean().optional(),fullScreenButton:s.boolean().optional(),geolocation:s.boolean().optional(),zoomControls:s.boolean().optional(),scaleBar:s.boolean().optional()}),b=s.object({type:s.literal("ui_controls.update"),params:k});var h={commands:[b],queries:null,listeners:null};var o=d(require("zod"),1);var p=d(require("zod"),1),z=p.number(),y=p.number(),L=p.object({latitude:y,longitude:z}),S=p.number().min(1).max(23),U=p.tuple([z,y,z,y]);var g=o.object({center:L,zoom:S}),te=o.intersection(g,o.object({bounds:U})),G=o.object({type:o.literal("viewport.get"),params:o.undefined()});var P=o.object({type:o.literal("center"),center:g.shape.center.optional(),zoom:g.shape.zoom.optional()}),O=o.object({type:o.literal("viewport.goto"),params:P}),C=o.object({eventName:o.literal("viewport.move"),id:o.string()});var j={commands:[O],queries:[G],listeners:[C]};var u=[h,j];var w={commands:u.map(e=>e.commands).flat(),queries:u.map(e=>e.queries??[]).flat(),listeners:u.map(e=>e.listeners??[]).flat()},D=t.discriminatedUnion("eventName",[t.object({eventName:t.literal("")}),...w.listeners]),H=t.object({type:t.literal("felt.addListener"),event:D}),I=t.object({type:t.literal("felt.removeListener"),id:t.string()}),_=t.strictObject({type:t.literal("felt.ready")}),v=t.discriminatedUnion("type",[_,H,I,...w.commands,...w.queries]),Z=t.object({type:t.enum(v.options.map(e=>e.shape.type.value))});function J(e,n,r){let c=new Map;async function a(l){if(!Z.safeParse(l.data).success){r?.onUnknownMessage?.(l.data);return}let x=v.safeParse(l.data);if(!x.success){r?.onInvalidMessage?.(l.data);return}let{data:i}=x;if(i.type==="felt.ready")l.ports[0]?.postMessage(!0);else if(i.type==="felt.addListener"){if(i.event.eventName==="")throw new Error("felt.addListener eventName cannot be empty");let f=n.listeners[i.event.eventName](M=>{l.ports[0]?.postMessage(M)});c.set(i.event.id,f)}else if(i.type==="felt.removeListener")c.get(i.id)?.(),c.delete(i.id);else{let f=n.methods[i.type],M=await f(i.params);l.ports[0]?.postMessage(M)}}return e.addEventListener("message",a),()=>{e.removeEventListener("message",a)}}0&&(module.exports={createMessageHandler});
